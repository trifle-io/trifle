# Production values for trifle
# This is an example production configuration

replicaCount: 3

image:
  repository: trifle/app
  pullPolicy: Always
  tag: "latest"

# Production resource limits
resources:
  limits:
    cpu: 2000m
    memory: 2Gi
  requests:
    cpu: 1000m
    memory: 1Gi

# Enable autoscaling for production
autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 15
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

# Production ingress configuration
ingress:
  enabled: true
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    cert-manager.io/issuer: "trifle-letsencrypt"
    nginx.ingress.kubernetes.io/rate-limit: "100"
    nginx.ingress.kubernetes.io/rate-limit-window: "1m"
  hosts:
    - host: trifle.yourdomain.com
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: trifle-tls
      hosts:
        - trifle.yourdomain.com

# Application configuration  
app:
  # IMPORTANT: Set this to a secure 64-character secret
  secretKeyBase: "CHANGE_ME_IN_PRODUCTION"
  host: "trifle.yourdomain.com"
  port: 4000
  poolSize: 20
  timezone: "UTC"
  deploymentMode: "self_hosted"  # Set to "saas" for multi-tenant mode

  # Third-party integrations
  honeybadger:
    apiKey: "CHANGE_ME_IN_PRODUCTION"  # Set your Honeybadger API key

  mailer:
    adapter: "sendgrid"
    from:
      name: "Trifle"
      email: "no-reply@yourdomain.com"
    sendgrid:
      apiKey: "CHANGE_ME_IN_PRODUCTION"

  openai:
    apiKey: "CHANGE_ME_WITH_OPENAI_KEY"
    model: "gpt-5"

  chat:
    mongo:
      url: "mongodb://mongo:27017/trifle_chat"
      poolSize: 10

  # User registration settings
  registration:
    enabled: false  # Disable registration in production for security

# Feature toggles
features:
  projects:
    enabled: false

# MongoDB sidecar configuration
mongo:
  image:
    repository: mongo
    tag: "7.0"
    pullPolicy: IfNotPresent
  resources: {}
  persistence:
    enabled: false
    storageClass: "fast-ssd"
    size: 20Gi
    accessModes:
      - ReadWriteOnce

# Initial user creation (runs during installation)
initialUser:
  enabled: true
  email: "admin@yourdomain.com"  # CHANGE_ME: Set your admin email
  password: "password"           # CHANGE_ME: Set a secure password
  admin: true

# Certificate Manager configuration
certManager:
  enabled: true
  kind: "Issuer"  # Use "ClusterIssuer" if you prefer cluster-wide
  server: "https://acme-v02.api.letsencrypt.org/directory"
  email: "admin@yourdomain.com"  # CHANGE_ME: Set your email for Let's Encrypt

# Enable persistent storage
persistence:
  enabled: true
  storageClass: "fast-ssd"  # Adjust based on your cluster
  size: 20Gi

# PostgreSQL production configuration
postgresql:
  enabled: true
  image:
    repository: postgres
    tag: "17.6"
    pullPolicy: IfNotPresent
  auth:
    username: trifle
    # IMPORTANT: Set secure password in production
    password: "CHANGE_ME_IN_PRODUCTION"
    database: trifle_prod
    existingSecret: ""
    existingSecretPasswordKey: "postgres-password"
  service:
    port: 5432
  persistence:
    enabled: true
    storageClass: "fast-ssd"  # Adjust based on your cluster
    size: 100Gi
    accessModes:
      - ReadWriteOnce
  resources:
    limits:
      cpu: 1000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi


# Node affinity for better distribution
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      podAffinityTerm:
        labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/name
            operator: In
            values:
            - trifle
        topologyKey: kubernetes.io/hostname
